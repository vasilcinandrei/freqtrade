import{d as C,aC as T,i as b,c as N,a as j,h as v,j as _,k as P,b as z,w as V,Y as F,H as q,o as y,X as Z,g as w,r as E,x as U,aT as J,Z as W,C as D,z as X}from"./index-aef5ad26.js";import{u as $,aI as k,aE as O,aF as A,aG as L,aH as S,aJ as I}from"./install-b71822da.js";import{j as M,e as B,k as H,f as Y,l as G,g as K,h as Q}from"./chartZoom-81ece22b.js";function tt(l,o){const n=Math.min(...l),m=(Math.max(...l)-n)*1.01/o,c=[...Array(o).keys()].map(e=>[Math.round((n+e*m)*1e3)/1e3,0]);for(let e=0;e<l.length;e++){const s=Math.min(Math.floor((l[e]-n)/m),o-1);isNaN(s)||c[s][1]++}return c}const et={class:"d-flex flex-column h-100 position-relative"},ot={class:"flex-grow-1 order-2"},g="Trade count",at=C({__name:"ProfitDistributionChart",props:{trades:{required:!0,type:Array},showTitle:{default:!0,type:Boolean}},setup(l){const o=l;$([M,k,O,B,A,L,S]);const n=T(),u=[10,15,20,25,50],m=b(()=>{const e=o.trades.map(s=>s.profit_ratio);return tt(e,n.profitDistributionBins)}),c=b(()=>({title:{text:"Profit distribution",show:o.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",dataset:{source:m.value},tooltip:{trigger:"axis",axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},legend:{data:[g],right:"5%",selectedMode:!1},xAxis:{type:"category",name:"Profit %",nameLocation:"middle",nameGap:25},yAxis:[{type:"value",name:g,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:35,position:"left"}],series:[{type:"bar",name:g,animation:!0,encode:{x:"x0",y:"y0"}}]}));return(e,s)=>{const r=Z,t=q;return y(),N("div",et,[j("div",ot,[l.trades?(y(),v(_(I),{key:0,option:c.value,autoresize:"",theme:_(n).chartTheme},null,8,["option","theme"])):P("",!0)]),z(t,{class:F(["order-1",l.showTitle?"ms-5 ps-5":"position-absolute"]),label:"Bins",style:{width:"33%","min-width":"12rem"},"label-for":"input-bins","label-cols":"6","content-cols":"6",size:"sm"},{default:V(()=>[z(r,{id:"input-bins",modelValue:_(n).profitDistributionBins,"onUpdate:modelValue":s[0]||(s[0]=d=>_(n).profitDistributionBins=d),size:"sm",class:"mt-1",options:u},null,8,["modelValue"])]),_:1},8,["class"])])}}});const dt=w(at,[["__scopeId","data-v-1dc7de89"]]),x="Profit",st=C({__name:"CumProfitChart",props:{trades:{required:!0,type:Array},openTrades:{required:!1,type:Array,default:()=>[]},showTitle:{default:!0,type:Boolean},profitColumn:{default:"profit_abs",type:String}},setup(l){const o=l;$([M,H,k,O,B,Y,A,L,S]);const n=T(),u=E(),m=b(()=>o.openTrades.reduce((r,t)=>r+(t.total_profit_abs??t[o.profitColumn]??0),0)),c=b(()=>{const r=[],t={},d=o.trades.slice().sort((i,h)=>i.close_timestamp>h.close_timestamp?1:-1);let p=0;for(let i=0,h=d.length;i<h;i+=1){const a=d[i];a.close_timestamp&&a[o.profitColumn]&&(p+=a[o.profitColumn],t[a.close_timestamp]?(t[a.close_timestamp].profit+=a[o.profitColumn],t[a.close_timestamp][a.botId]?t[a.close_timestamp][a.botId]+=a[o.profitColumn]:t[a.close_timestamp][a.botId]=p):t[a.close_timestamp]={profit:p,[a.botId]:p},r.push({date:a.close_timestamp,profit:p,[a.botId]:p}))}const f=Object.entries(t).map(([i,h])=>({date:parseInt(i,10),profit:h.profit}));if(o.openTrades.length>0&&f.length>0){const i=f[f.length-1];if(i){const h=(i.profit??0)+m.value;f.push({date:i.date,currentProfit:i.profit});const a=Date.now()+24*60*60*1e3;f.push({date:a,currentProfit:h})}}return f});function e(r=!1){var d;const t={dataset:{dimensions:["date","profit","currentProfit"],source:c.value},series:[{type:"line",name:"currentProfit",animation:r,lineStyle:{color:m.value>0?"green":"red",type:"dotted"},itemStyle:{color:m.value>0?"green":"red"},encode:{x:"date",y:"currentProfit"}},{type:"line",name:x,animation:r,step:"end",lineStyle:{color:n.chartTheme==="dark"?"#c2c2c2":"black"},itemStyle:{color:n.chartTheme==="dark"?"#c2c2c2":"black"},encode:{x:"date",y:"profit"}}]};(d=u.value)==null||d.setOption(t,{replaceMerge:["series","dataset"],noMerge:!r})}function s(){var t,d;(t=u.value)==null||t.setOption({},{noMerge:!0});const r={title:{text:"Cumulative Profit",show:o.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",tooltip:{trigger:"axis",formatter:p=>{const f=p[0].data.profit,i=p[0].data.currentProfit;return i?`Projected profit (incl. unrealized): ${D(i,3)}`:`Profit: ${D(f,3)}`},axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},legend:{data:[x],right:"5%",selectedMode:!1},useUTC:!1,xAxis:{type:"time"},yAxis:[{type:"value",name:x,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:40}],grid:{bottom:80},dataZoom:[{type:"inside",start:0,end:100},{bottom:10,start:0,end:100,...G}]};(d=u.value)==null||d.setOption(r,{noMerge:!0}),e(!0)}return U(()=>{s()}),J(()=>o.openTrades,()=>{e()},{throttle:60*1e3}),W(()=>o.trades,()=>{e()}),(r,t)=>l.trades?(y(),v(_(I),{key:0,ref_key:"chart",ref:u,autoresize:"","manual-update":"",theme:_(n).chartTheme},null,8,["theme"])):P("",!0)}});const ut=w(st,[["__scopeId","data-v-1860da4c"]]),R="Profit %",rt="#9be0a8",nt=C({__name:"TradesLog",props:{trades:{required:!0,type:Array},showTitle:{default:!0,type:Boolean}},setup(l){const o=l;$([M,H,k,O,B,A,L,S,K,Q]);const n=T(),u=b(()=>{const c=[],e=o.trades.slice(0).sort((s,r)=>s.close_timestamp>r.close_timestamp?1:-1);for(let s=0,r=e.length;s<r;s+=1){const t=e[s],d=[s,(t.profit_ratio*100).toFixed(2),t.pair,t.botName,X(t.close_timestamp),t.is_short===void 0||!t.is_short?"Long":"Short"];c.push(d)}return c}),m=b(()=>{const c=u.value.length>0?(1-50/u.value.length)*100:100;return{title:{text:"Trades log",show:o.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",dataset:{dimensions:["date","profit"],source:u.value},tooltip:{trigger:"axis",formatter:e=>{const s=e[0].data[3]?` | ${e[0].data[3]}`:"";return`${e[0].data[2]} | ${e[0].data[5]} ${s}<br>${e[0].data[4]}<br>Profit ${e[0].data[1]} %`},axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},xAxis:{type:"value",show:!1},yAxis:[{type:"value",name:R,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:30}],grid:{bottom:80},dataZoom:[{type:"inside",start:c,end:100},{bottom:10,start:c,end:100,...G}],visualMap:[{show:!0,seriesIndex:0,pieces:[{max:0,color:"#f84960"},{min:0,color:"#2ed191"}]}],series:[{type:"bar",name:R,barGap:"0%",barCategoryGap:"0%",animation:!1,label:{show:!0,position:"top",rotate:90,offset:[7.5,7.5],formatter:"{@[1]} %",color:n.chartTheme==="dark"?"#c2c2c2":"#3c3c3c"},encode:{x:0,y:1},itemStyle:{color:rt}}]}});return(c,e)=>l.trades.length>0?(y(),v(_(I),{key:0,option:m.value,autoresize:"",theme:_(n).chartTheme},null,8,["option","theme"])):P("",!0)}});const mt=w(nt,[["__scopeId","data-v-dd80fb73"]]);export{ut as C,dt as P,mt as T};
//# sourceMappingURL=TradesLog-008a12e7.js.map
